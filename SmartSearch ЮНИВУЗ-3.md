# SmartSearch ЮНИВУЗ-3

## Видение

SmartSearch (SS) представляет собой строку поиска на стороне личного кабинета, которая позволяет быстро находить и переходить к найденному объекту подключенных модулей. К примеру, в строке поиска можно ввести ФИО искомого человека, в поисковой выдаче будут отображены работники и студенты (с учетом прав доступа) с возможностью быстрого перехода к карточке студента/работника, или в строке поиска можно ввести наименование направления подготовки, при этом в поисковой выдаче должны отобразиться студенты, обучающиеся на данном направлении, учебные планы по данному направлению, направления подготовки из справочника и пр. связанные данные с учетом прав доступа пользователя. Результаты поисковой выдачи группируются по типу объекта (студент, работник, уч. план, дисциплина в промежуточном контроле и пр.). Максимальная сокрость поисковой выдачи достигнута за счет использования Manticore Search (или Elastic Search). 

## Архитектура решения

### FrontEnd

Поисковая строка встраивается в приложение lk-host в header приложения. Обращения идут в отдельный поисковый сервис 

### Backend

Сервис поиска представляет собой микросервис с несколькими точками взаимодействия:

- Пользовательская точка входа: метод, который принимает в качестве параметра поисковую строку, типы элементов для поиска, ограничение выдаваемых элементов по количеству, условия поиска ("начинается с..", "Равно", "Содержит" и т.д.). Метод отдает объект "Элемент поиска" с учетом прав доступа (показываются только те, на которые есть доступ на чтение), который содержит тип элемента (студент, сотрудник, элемент справочника, учебный план и пр), заголовок, короткое описание, фото (если доступно), ссылка на элемент

Получение элементов поиска из других сервисов:

- SS взаимодействует с другими сервисами через RabbitMQ
- SS подписывается на очереди сообщений (добавления/редактирования/удаления элементов поиска), остальные сервисы отправляют данные для поиска в данную очередь с указанием тип элемента (студент, сотрудник, элемент справочника, учебный план и пр), заголовок, короткое описание, фото (если доступно), ссылка на элемент, необходимые условия для доступа к элементу. Данные хранятся в специализированной БД для поисковой машины (ElasticSearch или Manticore Search) для быстрого доступа. Права доступа пользователя могут храниться в кеше (Redis) для быстрого доступа



## Кейсы использования

1) Сервис по сотрудникам при добавлении нового сотрудника (Иванов И.И.) из 1С отправляет данные в поисковый сервис (напрямую или через RabbitMQ), там они индексируются и становятся доступны для поисковой выдачи
2) Пользователь вбивает в поиспокую строку "иван". в выпадающем списке поисковый сервис выдает ему 120 записей по сотрудникам, 20 записей студентов (пользователь имеет права доступа к модулю Контингент на одном факультете), 3 записи с объявлениями (автор объявления - Иванов П.С.)
3) Пользователь может пролистать все записи и кликнуть на нужный элемент или отфильтровать записи по типу (или уточнить запрос)



1) Сотрудник учебного отдела вбивает в поисковую строку шифр специальности "3.03.10", выбирает условия поиска "Начинается с". В поисковой выдаче у него отображаются планы по данному шифру с возможностью быстрого перехода к ним



## Условия/порядок внедрения

При запуске сервиса, он должен автоматически создавать очереди для получения элементов поиска через RabbitMQ

По желанию и необходимости, любые сервисы могут добавлять свои типы объектов поиска. По данным типам в поисковой строке можно фильтровать данные

Все сервисы сами решают, какие данные будут доступны для поиска

В любой момент времени без необходимости доработок к поиску можно подключить любой другой сервис
